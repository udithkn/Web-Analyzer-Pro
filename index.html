<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ================== ADVANCED SEO OPTIMIZATION (CTR-FOCUSED) ================== -->
    <title>Free Website Analyzer &amp; SEO Audit Tool to Boost Your Google Ranking | Web Analyzer Pro</title>
    <meta name="description" content="Don't guess, know. Instantly audit your website with our free analyzer. Get a detailed SEO report, check Core Web Vitals, and uncover technical issues holding you back. Get actionable insights to outrank your competitors today. 100% free.">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="keywords" content="advanced website analyzer, free seo audit tool, website analysis, seo checker, performance checker, security scanner, content analysis, tech stack detector, free seo tool, core web vitals checker, on-page seo analysis, technical seo audit, website grader, free seo report, rich snippet checker, schema validator, website audit tool, free website checker, seo analysis online, google ranking checker tool">
    <meta name="author" content="Gemini Advanced">
    <link rel="canonical" href="https://udithkn.github.io/Web-Analyzer-Pro/">
    <!-- Add sitemap link when available: <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml"> -->

    <!-- Open Graph (for social sharing) -->
    <meta property="og:title" content="Web Analyzer Pro: #1 Free Advanced SEO Audit Tool">
    <meta property="og:description" content="Instantly run an advanced audit on any website for SEO, performance, security, and content issues with this 100% free, in-depth analysis tool.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://udithkn.github.io/Web-Analyzer-Pro/">
    <meta property="og:image" content="https://udithkn.github.io/Web-Analyzer-Pro/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Web Analyzer Pro">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Web Analyzer Pro: #1 Free Advanced SEO Audit Tool">
    <meta name="twitter:description" content="Instantly run an advanced audit on any website for SEO, performance, security, and content issues with this 100% free, in-depth analysis tool.">
    <meta name="twitter:image" content="https://udithkn.github.io/Web-Analyzer-Pro/twitter-image.png">

    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Structured Data (Schema.org) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebApplication",
          "name": "Web Analyzer Pro - Advanced SEO & Website Analysis Tool",
          "description": "A 100% free tool for advanced, in-depth website analysis, providing instant reports on performance, accessibility, SEO, security, content readability, color palettes, typography, assets, and the technology stack of any website. No sign-up required.",
          "applicationCategory": "DeveloperTool",
          "operatingSystem": "Any (Web-based)",
          "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
          "provider": { "@type": "Organization", "name": "Web Analyzer Pro" },
          "audience": { "@type": "Audience", "audienceType": ["Web Developers", "SEO Specialists", "Digital Marketers", "Content Strategists", "Web Designers"] },
          "featureList": ["Advanced On-Page SEO Audit", "Website Performance Analysis", "Core Web Vitals Check", "Security Header Checks", "Content Readability Scores", "Accessibility Scanning (WCAG)", "Technology Stack Detection", "Social Media Preview"],
          "url": "https://udithkn.github.io/Web-Analyzer-Pro/",
          "screenshot": "https://udithkn.github.io/Web-Analyzer-Pro/screenshot.jpg"
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Is Web Analyzer Pro truly free?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Yes, Web Analyzer Pro is 100% free to use. There are no hidden fees, no sign-up requirements, and no credit card needed. You can analyze as many websites as you like."
              }
            },
            {
              "@type": "Question",
              "name": "What does the advanced SEO audit include?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Our advanced SEO audit covers over 50 critical on-page and technical data points. This includes a full analysis of meta tags, heading structure (H1-H6), internal and external link profiles, structured data (Schema) validation, canonical tag checks, and much more."
              }
            },
            {
              "@type": "Question",
              "name": "How does this tool help me rank higher on Google?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "By identifying critical on-page and technical SEO issues, our tool provides a clear, actionable checklist of improvements. Fixing these issues helps your site meet Google's quality guidelines, improve user experience, and demonstrate expertise, which are key factors for outperforming competitors and achieving higher search rankings."
              }
            },
            {
              "@type": "Question",
              "name": "How quickly can I see results from this SEO audit?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Our tool provides an instant report with an actionable checklist. By implementing the recommended fixes for critical errors, you can signal positive changes to Google quickly. While major ranking shifts take time, fixing technical issues can often lead to improved crawlability and indexing within weeks."
              }
            }
          ]
        }
      ]
    }
    </script>
    <!-- ================== END ADVANCED SEO OPTIMIZATION ================== -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Charting Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .focus-ring:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.6); }
        .scrollable-tabs::-webkit-scrollbar { display: none; }
        .scrollable-tabs { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animations */
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader { animation: spin 1s linear infinite; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }

        @keyframes slide-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slide-up 0.5s ease-out forwards; }

        .animated-card { opacity: 0; } /* Start hidden */
        
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-3deg); }
          20%, 80% { transform: translate3d(2px, 0, 0) rotate(3deg); }
          30%, 50%, 70% { transform: translate3d(-3px, 0, 0) rotate(-3deg); }
          40%, 60% { transform: translate3d(3px, 0, 0) rotate(3deg); }
        }
        .animate-shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }

        .pro-badge {
            background-image: linear-gradient(to right, #3b82f6, #8b5cf6);
            color: white;
            font-size: 0.65rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 9999px;
            margin-left: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Print-specific styles */
        @media print {
            body * { visibility: hidden; }
            #results-state, #results-state * { visibility: visible; }
            #results-state { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            #tabs, #tab-content-container { border: none !important; }
            .tab-content { display: block !important; page-break-before: always; }
            .tab-content:first-child { page-break-before: auto; }
        }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen flex flex-col lg:flex-row">
        <!-- Sidebar -->
        <aside class="w-full lg:w-96 bg-slate-900/80 backdrop-blur-sm border-r border-slate-700/50 p-4 sm:p-6 lg:p-8 flex-shrink-0 flex flex-col no-print">
            <div>
                <div class="flex items-center gap-3 mb-8">
                    <img src="favicon.png" alt="Web Analyzer Pro Logo" class="w-8 h-8">
                    <h1 class="text-2xl font-bold text-slate-100">Web Analyzer <span class="text-blue-400">Pro</span></h1>
                </div>

                <div class="space-y-6">
                    <div>
                        <label for="urlInput" class="text-sm font-medium text-slate-300 mb-2 block">Enter Website URL to Audit</label>
                        <div class="relative">
                            <i data-lucide="link-2" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                            <input type="url" id="urlInput" placeholder="https://example.com" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg pl-10 pr-4 py-2.5 text-slate-100 placeholder-slate-500 focus-ring">
                        </div>
                    </div>
                    <button id="analyzeBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2 focus-ring transition-colors duration-200">
                        <i data-lucide="wand-sparkles" class="w-5 h-5"></i>
                        <span>Run Advanced SEO Audit</span>
                    </button>
                </div>
                
                <div id="message-area" class="mt-6"></div>
                <div id="download-area" class="mt-4 space-y-2"></div>
                
                <!-- Analysis History Section -->
                <div id="history-section" class="mt-8">
                    <h2 class="text-lg font-semibold text-slate-200 mb-3">Recent Analyses</h2>
                    <ul id="history-list" class="space-y-2">
                        <!-- History items will be injected here -->
                    </ul>
                </div>
            </div>
            
            <footer class="mt-auto pt-8 text-center text-xs text-slate-500">
                <p>&copy; <span id="copyright-year"></span> Udith Babu K N. All Rights Reserved.</p>
            </footer>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto">
            <div id="initial-state" class="h-full flex flex-col items-center justify-center text-center">
                 <i data-lucide="search-code" class="w-24 h-24 text-slate-600 mb-4"></i>
                 <h1 class="text-3xl font-bold text-slate-200">Find &amp; Fix SEO Issues Holding Your Website Back</h1>
                 <h2 class="text-slate-400 mt-2 max-w-xl font-normal">Get a free, actionable report on your website's technical SEO, on-page optimization, performance, and security to start outranking your competition.</h2>
                 <div class="mt-6">
                    <p class="text-slate-500 text-sm mb-2">Or try one of these:</p>
                    <div class="flex flex-wrap gap-2 justify-center">
                        <button class="example-url-btn bg-slate-700/50 hover:bg-slate-700 text-slate-300 px-3 py-1 rounded-full text-sm transition-colors">google.com</button>
                        <button class="example-url-btn bg-slate-700/50 hover:bg-slate-700 text-slate-300 px-3 py-1 rounded-full text-sm transition-colors">github.com</button>
                    </div>
                 </div>
            </div>

            <div id="loading-state" class="hidden h-full flex flex-col items-center justify-center">
                <i data-lucide="loader-2" class="w-16 h-16 text-blue-400 loader"></i>
                <p class="text-slate-300 mt-4 text-lg">Performing deep analysis...</p>
                <div class="w-full max-w-md bg-slate-700 rounded-full h-2.5 mt-4 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="loading-status" class="text-slate-500 mt-2 text-sm">Initializing...</p>
            </div>

            <div id="results-state" class="hidden">
                <div class="border-b border-slate-700 mb-6 no-print">
                    <nav id="tabs" class="-mb-px flex space-x-6 overflow-x-auto scrollable-tabs" aria-label="Tabs"></nav>
                </div>
                <div id="tab-content-container"></div>
            </div>
        </main>
    </div>

    <script>
        // --- UTILITY AND HELPER FUNCTIONS ---
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-').replace(/[^\w-]+/g, '')
                .replace(/--+/g, '-').replace(/^-+/, '').replace(/-+$/, '');
        }

        async function fetchWithProxy(url) {
            // Using a CORS proxy to fetch website content client-side.
            // Note: This has limitations and may not work for all sites due to security policies (CSP, etc.).
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
            try {
                // Set a timeout for the fetch request.
                const response = await fetch(proxyUrl, { signal: AbortSignal.timeout(15000) });
                if (!response.ok) throw new Error(`Request failed with status: ${response.status}`);
                const data = await response.text();
                // Check for common proxy error messages.
                if (!data || data.includes("The service is temporarily unavailable")) throw new Error("Proxy service returned an error.");
                return data;
            } catch (error)
            {
                console.error('Fetch failed:', error);
                throw new Error("We couldn't analyze that URL. This can happen if the site is offline, has strong anti-bot protection, or the request timed out. Please try another site.");
            }
        }

        function copyToClipboard(text, element) {
            // Simple clipboard copy function.
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const originalText = element.innerHTML;
                element.innerHTML = '<i data-lucide="check" class="w-4 h-4 text-green-400"></i> Copied!';
                lucide.createIcons();
                setTimeout(() => { element.innerHTML = originalText; lucide.createIcons(); }, 1500);
            } catch (err) { console.error('Failed to copy text: ', err); }
            document.body.removeChild(textArea);
        }
        
        function showMessage(message, type = 'error') {
            // Display dynamic messages (errors, warnings) to the user.
            const messageArea = $('#message-area');
            const colors = {
                error: 'bg-red-500/10 border-red-500/30 text-red-400',
                warning: 'bg-yellow-500/10 border-yellow-500/30 text-yellow-400',
                retry: 'bg-blue-500/10 border-blue-500/30 text-blue-300'
            };
            
            let iconHtml = '';
            let animationClass = '';
            if (type === 'retry') {
                iconHtml = '<i data-lucide="refresh-cw" class="w-8 h-8 mr-4 flex-shrink-0"></i>';
                animationClass = 'animate-shake';
            }

            messageArea.innerHTML = `
                <div class="p-4 rounded-lg border ${colors[type]} flex items-center ${animationClass}">
                    ${iconHtml}
                    <p class="text-sm">${message}</p>
                </div>`;
            
            if (type === 'retry') {
                lucide.createIcons();
            }
        }
        
        function updateLoadingStatus(text, progress) {
            $('#loading-status').textContent = text;
            $('#progress-bar').style.width = `${progress}%`;
        }

        // --- ANALYSIS HISTORY (LOCALSTORAGE) ---
        function getHistory() {
            return JSON.parse(localStorage.getItem('analysisHistory') || '[]');
        }

        function saveToHistory(url) {
            let history = getHistory();
            const cleanUrl = url.replace(/^https?:\/\//, '');
            history = history.filter(item => item !== cleanUrl);
            history.unshift(cleanUrl);
            localStorage.setItem('analysisHistory', JSON.stringify(history.slice(0, 5)));
            renderHistory();
        }

        function renderHistory() {
            const history = getHistory();
            const list = $('#history-list');
            if (!list) return;
            if (history.length === 0) {
                list.innerHTML = `<li class="text-slate-500 text-sm">No recent analyses.</li>`;
                return;
            }
            list.innerHTML = history.map(url => `
                <li class="flex items-center justify-between group">
                    <a href="#" class="history-item-link text-slate-400 hover:text-blue-400 text-sm truncate" data-url="${url}">${url}</a>
                    <button class="remove-history-item opacity-0 group-hover:opacity-100 transition-opacity" data-url="${url}">
                        <i data-lucide="x" class="w-4 h-4 text-slate-500 hover:text-red-400"></i>
                    </button>
                </li>
            `).join('');
            lucide.createIcons();
        }

        function removeFromHistory(url) {
             let history = getHistory();
             history = history.filter(item => item !== url);
             localStorage.setItem('analysisHistory', JSON.stringify(history));
             renderHistory();
        }

        // --- CORE ANALYSIS LOGIC ---
        async function analyzeWebsite(urlToAnalyze) {
            const url = urlToAnalyze || $('#urlInput').value.trim();
            if (!url) {
                showMessage('Please enter a website URL.');
                return;
            }
            const fullUrl = url.match(/^https?:\/\//) ? url : `https://${url}`;
            $('#urlInput').value = fullUrl;

            // Reset UI states
            $('#message-area').innerHTML = '';
            $('#download-area').innerHTML = '';
            $('#initial-state').classList.add('hidden');
            $('#results-state').classList.add('hidden');
            $('#loading-state').classList.remove('hidden');

            try {
                updateLoadingStatus('Fetching website content...', 10);
                const html = await fetchWithProxy(fullUrl);
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const baseURL = new URL(fullUrl).origin;

                // Run all analysis modules
                updateLoadingStatus('Analyzing styles and assets...', 20);
                const colors = extractColors(doc);
                const typography = extractTypography(doc);
                const assets = extractAssets(doc, baseURL);

                updateLoadingStatus('Detecting technology stack...', 35);
                const techStack = detectTechStack(doc, html);

                updateLoadingStatus('Auditing SEO and headings...', 50);
                const seo = extractSeoData(doc, html);
                
                updateLoadingStatus('Scanning for accessibility issues...', 65);
                const accessibility = checkAccessibility(doc);
                
                updateLoadingStatus('Checking performance metrics...', 75);
                const performance = checkPerformance(doc, html);

                updateLoadingStatus('Analyzing content and security...', 85);
                const content = analyzeContent(doc);
                const security = analyzeSecurity(doc, fullUrl);
                const social = analyzeSocial(doc);

                // Compile the final report object
                const fullReport = { url: fullUrl, generatedAt: new Date().toISOString(), colors, typography, assets, techStack, seo, accessibility, performance, content, security, social };
                
                updateLoadingStatus('Generating report...', 100);
                renderResults(fullReport);
                saveToHistory(fullUrl);

                $('#loading-state').classList.add('hidden');
                $('#results-state').classList.remove('hidden');

            } catch (error) {
                console.error('Analysis failed:', error);
                if (error.message.startsWith("We couldn't analyze")) {
                     showMessage(
                        `${error.message}<br><br><strong>Tip:</strong> Sometimes it takes 2-3 tries. Give it another go!`,
                        'retry'
                    );
                } else {
                    showMessage(error.message);
                }
                $('#loading-state').classList.add('hidden');
                $('#initial-state').classList.remove('hidden');
                updateLoadingStatus('Idle', 0);
            }
        }
        
        // --- EXTRACTION & ANALYSIS MODULES ---
        function extractColors(doc) {
            const colors = new Set();
            const colorRegex = /(#[0-9a-f]{3,8}|(rgba?|hsla?)\([^)]+\))/gi;
            doc.querySelectorAll('[style]').forEach(el => {
                const style = el.getAttribute('style');
                const found = style.match(colorRegex);
                if (found) found.forEach(c => colors.add(c.toLowerCase()));
            });
            doc.querySelectorAll('style').forEach(styleTag => {
                const found = styleTag.innerHTML.match(colorRegex);
                if (found) found.forEach(c => colors.add(c.toLowerCase()));
            });
            return { palette: Array.from(colors) };
        }

        function extractTypography(doc) {
            const fontDetails = { families: new Set(), sizes: new Set(), weights: new Set() };
            const fontFamilyRegex = /font-family:([^;]+)/gi;
            const fontSizeRegex = /font-size:([^;]+)/gi;
            const fontWeightRegex = /font-weight:([^;]+)/gi;
            function parseStyle(styleText) {
                let match;
                while((match = fontFamilyRegex.exec(styleText)) !== null) match[1].split(',').forEach(f => fontDetails.families.add(f.trim().replace(/['"]/g, '')));
                while((match = fontSizeRegex.exec(styleText)) !== null) fontDetails.sizes.add(match[1].trim());
                while((match = fontWeightRegex.exec(styleText)) !== null) fontDetails.weights.add(match[1].trim());
            }
            doc.querySelectorAll('[style]').forEach(el => parseStyle(el.getAttribute('style')));
            doc.querySelectorAll('style').forEach(styleTag => parseStyle(styleTag.innerHTML));
            return {
                families: Array.from(fontDetails.families),
                sizes: Array.from(fontDetails.sizes),
                weights: Array.from(fontDetails.weights)
            };
        }

        function extractAssets(doc, baseURL) {
            const assets = { images: [], svgs: [] };
            doc.querySelectorAll('img').forEach(img => {
                if (img.src) {
                    try { assets.images.push({ src: new URL(img.src, baseURL).href, alt: img.alt || 'N/A' }); } catch(e) {}
                }
            });
            doc.querySelectorAll('svg').forEach(svg => {
                const svgHtml = svg.outerHTML;
                const dataUri = `data:image/svg+xml;base64,${btoa(svgHtml)}`;
                assets.svgs.push({ html: svgHtml, dataUri });
            });
            return assets;
        }

        function detectTechStack(doc, html) {
            const tech = new Set();
            const detections = {
                'React': () => doc.querySelector('[data-reactroot], #___gatsby, #__next'),
                'Vue.js': () => doc.querySelector('#app[data-v-app]'),
                'Angular': () => doc.querySelector('[ng-version]'),
                'Svelte': () => doc.querySelector('.svelte-app'),
                'jQuery': () => html.includes('jquery.js') || html.includes('jquery.min.js'),
                'WordPress': () => html.includes('wp-content/') || html.includes('wp-json/'),
                'Shopify': () => html.includes('cdn.shopify.com'),
                'Bootstrap': () => doc.querySelector('link[href*="bootstrap"], div[class*="col-"]'),
                'Tailwind CSS': () => doc.querySelector('link[href*="tailwind"], style[id*="tailwind"]'),
                'GSAP': () => html.includes('gsap.min.js'),
                'Google Analytics': () => html.includes('google-analytics.com/analytics.js') || html.includes('googletagmanager.com/gtag/js'),
            };
            for (const [name, detector] of Object.entries(detections)) {
                try { if (detector()) tech.add(name); } catch (e) {}
            }
            return Array.from(tech);
        }

        function extractSeoData(doc, html) {
            const getMeta = (name) => doc.querySelector(`meta[name="${name}"], meta[property="og:${name}"]`)?.content || null;
            const headings = {};
            ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].forEach(h => {
                headings[h] = Array.from(doc.querySelectorAll(h)).map(el => el.textContent.trim());
            });
            const links = { internal: 0, external: 0, nofollow: 0 };
            const pageHost = new URL(doc.baseURI).hostname;
            doc.querySelectorAll('a[href]').forEach(a => {
                try {
                    const linkHost = new URL(a.href).hostname;
                    if (linkHost === pageHost) links.internal++;
                    else links.external++;
                    if (a.rel.includes('nofollow')) links.nofollow++;
                } catch(e) {}
            });
            const structuredData = Array.from(doc.querySelectorAll('script[type="application/ld+json"]')).map(s => s.innerHTML);
            
            return {
                title: doc.title || null,
                description: getMeta('description'),
                keywords: getMeta('keywords'),
                ogTitle: getMeta('title'),
                ogDescription: getMeta('description'),
                ogImage: getMeta('image'),
                canonical: doc.querySelector('link[rel="canonical"]')?.href || null,
                headings,
                links,
                structuredData
            };
        }

        function checkPerformance(doc, html) {
            const scripts = Array.from(doc.querySelectorAll('script[src]'));
            const stylesheets = Array.from(doc.querySelectorAll('link[rel="stylesheet"]'));
            const inlineStyles = Array.from(doc.querySelectorAll('style'));
            const images = Array.from(doc.querySelectorAll('img'));
            const cdnHosts = ['cdn.', 'cdnjs.cloudflare.com', 'maxcdn.bootstrapcdn.com', 'code.jquery.com', 'unpkg.com', 'jsdelivr.net'];
            const cdnUsage = [...scripts, ...stylesheets].some(res => cdnHosts.some(cdn => res.href?.includes(cdn) || res.src?.includes(cdn)));
            const unoptimizedImages = images.filter(img => !img.loading || img.loading !== 'lazy').length;

            return {
                requestCounts: { totalJS: scripts.length, totalCSS: stylesheets.length, totalImages: images.length },
                scripts: scripts.map(s => ({ src: s.src, async: s.async, defer: s.defer })),
                inlineStyleBlocks: inlineStyles.length,
                htmlSize: { raw: html.length, formatted: `${(html.length / 1024).toFixed(2)} KB` },
                cdnUsage,
                unoptimizedImages
            };
        }

        function checkAccessibility(doc) {
            const issues = [];
            doc.querySelectorAll('img:not([alt])').forEach((img, i) => issues.push({ type: 'Warning', check: 'Images', issue: `Image ${i + 1} is missing an alt attribute.`, element: img.outerHTML }));
            doc.querySelectorAll('a:not([aria-label]):not([aria-labelledby])').forEach((a, i) => {
                if (!a.innerText.trim() && !a.querySelector('img[alt]')) {
                     issues.push({ type: 'Warning', check: 'Links', issue: `Link ${i + 1} has no discernible text.`, element: a.outerHTML });
                }
            });
            doc.querySelectorAll('input:not([type=hidden]), textarea, select').forEach((input, i) => {
                if(!input.id || !doc.querySelector(`label[for="${input.id}"]`)) {
                    issues.push({ type: 'Warning', check: 'Forms', issue: `Input element may be missing an associated label.`, element: input.outerHTML });
                }
            });
            if (!doc.documentElement.lang) {
                issues.push({ type: 'Error', check: 'Language', issue: 'The <html> tag is missing a "lang" attribute.', element: '<html>' });
            }
            return { issues };
        }

        function analyzeContent(doc) {
            const textContent = doc.body.innerText || "";
            const words = textContent.match(/\b\w+\b/g) || [];
            const sentences = textContent.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const syllables = textContent.match(/[aeiouy]{1,2}/gi)?.length || 0;
            
            const wordCount = words.length;
            const sentenceCount = sentences.length;
            
            // Flesch-Kincaid Readability Score
            let readabilityScore = 0;
            if (wordCount > 0 && sentenceCount > 0) {
                readabilityScore = 206.835 - 1.015 * (wordCount / sentenceCount) - 84.6 * (syllables / wordCount);
            }

            return {
                wordCount,
                sentenceCount,
                readabilityScore: Math.round(readabilityScore)
            };
        }

        function analyzeSecurity(doc, url) {
            const checks = [];
            const csp = doc.querySelector('meta[http-equiv="Content-Security-Policy"]');
            checks.push({
                name: 'Content Security Policy (CSP)',
                present: !!csp,
                value: csp ? csp.content : 'Not Found',
                recommendation: 'A strong CSP helps prevent XSS attacks.'
            });

            const mixedContent = Array.from(doc.querySelectorAll('img[src^="http:"], script[src^="http:"], link[href^="http:"]'));
            checks.push({
                name: 'Mixed Content',
                present: mixedContent.length > 0,
                value: `${mixedContent.length} insecure assets found`,
                recommendation: 'Serve all assets over HTTPS to prevent security warnings.'
            });

            return { checks };
        }
        
        function analyzeSocial(doc) {
            const getMeta = (prop) => doc.querySelector(`meta[property="${prop}"]`)?.content || null;
            return {
                og: {
                    title: getMeta('og:title'),
                    description: getMeta('og:description'),
                    image: getMeta('og:image'),
                    type: getMeta('og:type'),
                    url: getMeta('og:url'),
                },
                twitter: {
                    card: getMeta('twitter:card'),
                    title: getMeta('twitter:title'),
                    description: getMeta('twitter:description'),
                    image: getMeta('twitter:image'),
                }
            };
        }


        // --- REPORT RENDERING ---
        function renderResults(report) {
            const tabsContainer = $('#tabs');
            const contentContainer = $('#tab-content-container');
            tabsContainer.innerHTML = '';
            contentContainer.innerHTML = '';
            
            const tabs = {
                'Overview': { icon: 'layout-dashboard', content: renderOverview(report) },
                'SEO': { icon: 'siren', content: renderSeo(report.seo) },
                'Performance': { icon: 'gauge-circle', content: renderPerformance(report.performance) },
                'Accessibility': { icon: 'person-standing', content: renderAccessibility(report.accessibility) },
                'Content': { icon: 'file-text', content: renderContent(report.content), pro: true },
                'Security': { icon: 'shield', content: renderSecurity(report.security), pro: true },
                'Social': { icon: 'share-2', content: renderSocial(report.social), pro: true },
                'Tech Stack': { icon: 'cpu', content: renderTechStack(report.techStack) },
                'Colors': { icon: 'palette', content: renderColors(report.colors) },
                'Typography': { icon: 'type', content: renderTypography(report.typography) },
                'Assets': { icon: 'image', content: renderAssets(report.assets) },
            };

            Object.entries(tabs).forEach(([name, data], index) => {
                const tabId = slugify(name);
                const button = document.createElement('button');
                button.className = `flex-shrink-0 flex items-center gap-2 px-3 py-3 text-sm font-medium border-b-2 transition-colors duration-200 ${index === 0 ? 'border-blue-400 text-blue-300' : 'border-transparent text-slate-400 hover:text-slate-200 hover:border-slate-500'}`;
                button.innerHTML = `<i data-lucide="${data.icon}" class="w-5 h-5"></i><span>${name}</span> ${data.pro ? '<span class="pro-badge">Pro</span>' : ''}`;
                button.dataset.tab = tabId;
                tabsContainer.appendChild(button);

                const contentDiv = document.createElement('div');
                contentDiv.className = `tab-content fade-in ${index > 0 ? 'hidden' : ''}`;
                contentDiv.id = `content-${tabId}`;
                contentDiv.innerHTML = data.content;
                contentContainer.appendChild(contentDiv);
            });
            
            if (tabs.Overview) {
                renderHealthChart(report);
            }

            renderActionButtons(report);
            lucide.createIcons();
            addTabEventListeners();
            addCopyEventListeners();
            injectSvgs();
            
            $$('#results-state .animated-card').forEach((card, i) => {
                setTimeout(() => card.classList.add('slide-up'), i * 100);
            });
        }
        
        function renderSection(title, content, options = {}) {
            if (!content || (Array.isArray(content) && content.length === 0)) {
                return `<h3 class="text-xl font-semibold text-slate-200 mb-4">${title}</h3><p class="text-slate-400">Nothing found.</p>`;
            }
            // Responsive classes added to the wrapper
            return `<div class="bg-slate-800/50 p-4 md:p-6 rounded-lg border border-slate-700 ${options.className || ''}">
                        <h3 class="text-lg md:text-xl font-semibold text-slate-200 mb-4">${title}</h3>
                        ${content}
                    </div>`;
        }
        
        function renderScoreCard(title, score, description) {
            const scoreColor = score > 89 ? 'text-green-400' : score > 49 ? 'text-yellow-400' : 'text-red-400';
            return `<div class="bg-slate-800/50 p-4 md:p-6 rounded-lg border border-slate-700">
                    <div class="flex items-baseline gap-2 md:gap-4">
                        <span class="text-4xl md:text-5xl font-bold ${scoreColor}">${score}</span>
                        <h4 class="text-lg md:text-xl font-semibold text-slate-200">${title}</h4>
                    </div>
                    <p class="text-slate-400 mt-2 text-sm md:text-base">${description}</p>
                </div>`;
        }

        function renderOverview(report) {
            const accIssues = report.accessibility.issues.length;
            const accScore = Math.max(0, 100 - accIssues * 5);
            const perfIssues = report.performance.scripts.filter(s => !s.async && !s.defer).length + report.performance.inlineStyleBlocks;
            const perfScore = Math.max(0, 100 - perfIssues * 10);
            const seoIssues = (report.seo.headings.h1?.length !== 1 ? 1 : 0) + (!report.seo.description ? 1 : 0);
            const seoScore = Math.max(0, 100 - seoIssues * 25);
            const securityIssues = report.security.checks.filter(c => c.present).length;
            const securityScore = Math.max(0, 100 - securityIssues * 25);
            
            // Added responsive grid classes for better alignment on tablets (md)
            return `<div class="grid grid-cols-1 lg:grid-cols-5 gap-4 md:gap-8 animated-card">
                        <div class="lg:col-span-3 bg-slate-800/50 p-4 md:p-6 rounded-lg border border-slate-700">
                            <h3 class="text-xl font-semibold text-slate-200 mb-4">Website Health</h3>
                            <div class="h-64 sm:h-80 w-full"><canvas id="healthChart"></canvas></div>
                        </div>
                        <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4 md:gap-6">
                            ${renderScoreCard('SEO', seoScore, `${seoIssues} critical issues found.`)}
                            ${renderScoreCard('Performance', perfScore, `${perfIssues} optimizations found.`)}
                            ${renderScoreCard('Accessibility', accScore, `${accIssues} issues found.`)}
                            ${renderScoreCard('Security', securityScore, `${securityIssues} risks found.`)}
                        </div>
                    </div>`;
        }
        
        function renderHealthChart(report) {
            const ctx = $('#healthChart')?.getContext('2d');
            if (!ctx) return;

            const accScore = Math.max(0, 100 - report.accessibility.issues.length * 5);
            const perfScore = Math.max(0, 100 - (report.performance.scripts.filter(s => !s.async && !s.defer).length + report.performance.inlineStyleBlocks) * 10);
            const seoScore = Math.max(0, 100 - ((report.seo.headings.h1?.length !== 1 ? 1 : 0) + (!report.seo.description ? 1 : 0)) * 25);
            const securityScore = Math.max(0, 100 - report.security.checks.filter(c => c.present).length * 25);


            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['SEO', 'Performance', 'Accessibility', 'Security'],
                    datasets: [{
                        label: 'Health Score',
                        data: [seoScore, perfScore, accScore, securityScore],
                        fill: true,
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(59, 130, 246)'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' },
                            pointLabels: { color: '#f8fafc', font: { size: 14 } },
                            ticks: { color: '#94a3b8', backdropColor: 'rgba(0,0,0,0)', stepSize: 25 },
                            min: 0, max: 100
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function renderAccessibility(accessibility) {
            if (accessibility.issues.length === 0) {
                return `<div class="flex items-center gap-3 bg-green-500/10 text-green-300 p-4 rounded-lg"><i data-lucide="check-circle-2" class="w-8 h-8"></i><p>No basic accessibility issues found. Great job!</p></div>`;
            }
            const renderIssue = issue => {
                const colors = { Warning: 'border-yellow-400 bg-yellow-500/10 text-yellow-300', Error: 'border-red-400 bg-red-500/10 text-red-300' };
                return `<div class="border-l-4 p-4 rounded-r-lg ${colors[issue.type]}">
                            <p class="font-semibold">${issue.check}: ${issue.issue}</p>
                            <code class="text-xs text-slate-400/80 mt-2 block bg-black/20 p-2 rounded break-words overflow-x-auto">${issue.element.replace(/</g, '&lt;')}</code>
                        </div>`;
            }
            return `<div class="space-y-4">${accessibility.issues.map(renderIssue).join('')}</div>`;
        }

        function renderPerformance(perf) {
            const scriptsHtml = perf.scripts.map(s => `
                <li class="flex items-center gap-2 text-sm">
                    <i data-lucide="${s.async || s.defer ? 'check-circle' : 'x-circle'}" class="w-4 h-4 ${s.async || s.defer ? 'text-green-400' : 'text-red-400'}"></i>
                    <span class="font-mono truncate flex-1 min-w-0" title="${s.src}">${s.src.split('/').pop()}</span>
                    ${s.async ? '<span class="text-xs bg-sky-500/20 text-sky-300 px-2 py-0.5 rounded-full">async</span>' : ''}
                    ${s.defer ? '<span class="text-xs bg-purple-500/20 text-purple-300 px-2 py-0.5 rounded-full">defer</span>' : ''}
                </li>`).join('');
            const renderRow = (label, value, status) => {
                const statusColor = status === 'good' ? 'text-green-400' : status === 'bad' ? 'text-red-400' : 'text-slate-400';
                return `<li class="flex justify-between items-center py-2"><span class="text-slate-300">${label}</span><span class="font-bold ${statusColor}">${value}</span></li>`;
            }

            return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8">
                    ${renderSection('Metrics', `
                        <ul class="divide-y divide-slate-700/50">
                            ${renderRow('JavaScript Files', perf.requestCounts.totalJS)}
                            ${renderRow('CSS Files', perf.requestCounts.totalCSS)}
                            ${renderRow('Image Files', perf.requestCounts.totalImages)}
                            ${renderRow('HTML Size', perf.htmlSize.formatted)}
                            ${renderRow('CDN Usage', perf.cdnUsage ? 'Detected' : 'Not Detected', perf.cdnUsage ? 'good' : 'bad')}
                            ${renderRow('Un-optimized Images', `${perf.unoptimizedImages} found`, perf.unoptimizedImages > 0 ? 'bad' : 'good')}
                        </ul>`)}
                    ${renderSection('Script Loading Analysis', `<ul class="space-y-3">${scriptsHtml || '<p class="text-slate-400">No scripts found.</p>'}</ul>`)}
                </div>`;
        }

        function renderSeo(seo) {
            const h1Count = seo.headings.h1?.length || 0;
            const h1Color = h1Count === 1 ? 'text-green-400' : 'text-red-400';
            const headingsHtml = Object.entries(seo.headings).map(([tag, list]) => list.length > 0 ? `
                <div class="mt-2"><h4 class="font-semibold text-slate-300">${tag.toUpperCase()} (${list.length})</h4><ul class="list-disc list-inside pl-2 text-slate-400 text-sm break-words">${list.map(h => `<li>${h}</li>`).join('')}</ul></div>` : '').join('');
            const renderRow = (label, value, status) => {
                const statusColor = status === 'good' ? 'text-green-400' : status === 'bad' ? 'text-red-400' : 'text-slate-400';
                return `<div class="py-3 sm:grid sm:grid-cols-3 sm:gap-4"><dt class="text-sm font-medium text-slate-400">${label}</dt><dd class="mt-1 text-sm sm:mt-0 sm:col-span-2 ${statusColor} break-words">${value || 'Not found'}</dd></div>`;
            }
            const structuredDataHtml = seo.structuredData.map((data, i) => {
                try {
                    return `<div class="mt-2">
                        <h4 class="font-semibold text-slate-300">Schema #${i+1}</h4>
                        <pre class="bg-black/20 p-3 rounded-md text-xs text-slate-300 overflow-auto mt-1"><code>${JSON.stringify(JSON.parse(data), null, 2)}</code></pre>
                    </div>`
                } catch(e) { return '' }
            }).join('');

            return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8">
                    ${renderSection('Meta Tags', `
                        <dl class="divide-y divide-slate-700">
                            ${renderRow('Title Tag', seo.title, seo.title ? 'good' : 'bad')}
                            ${renderRow('Meta Description', seo.description, seo.description ? 'good' : 'bad')}
                            ${renderRow('Canonical URL', seo.canonical, seo.canonical ? 'good' : 'bad')}
                            ${renderRow('Keywords', seo.keywords || 'Not found')}
                        </dl>`)}
                    ${renderSection('Heading Structure', `<div class="flex items-center gap-2 mb-4"><i data-lucide="${h1Count === 1 ? 'check-circle' : 'x-circle'}" class="w-5 h-5 ${h1Color}"></i><span class="${h1Color}">${h1Count} &lt;h1&gt; tag${h1Count !== 1 ? 's' : ''} found.</span></div>${headingsHtml}`)}
                    ${renderSection('Link Analysis', `
                        <ul class="space-y-2 text-slate-300">
                            <li class="flex justify-between"><span>Internal Links:</span><span class="font-bold">${seo.links.internal}</span></li>
                            <li class="flex justify-between"><span>External Links:</span><span class="font-bold">${seo.links.external}</span></li>
                            <li class="flex justify-between"><span>Nofollow Links:</span><span class="font-bold">${seo.links.nofollow}</span></li>
                        </ul>`)}
                    ${renderSection('Structured Data (Schema)', structuredDataHtml || '<p class="text-slate-400">No structured data found.</p>')}
                </div>`;
        }
        
        function renderColors(colors) {
            if (colors.palette.length === 0) return '<p class="text-slate-400">No colors found in inline or embedded styles.</p>';
            const content = `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4">
                    ${colors.palette.map(color => `<div class="group">
                            <div class="w-full h-24 rounded-lg border border-slate-700" style="background-color: ${color};"></div>
                            <button class="copy-btn mt-2 text-sm text-slate-300 font-mono group-hover:text-blue-400 transition-colors break-all" data-copy="${color}">${color}</button>
                        </div>`).join('')}</div>`;
            return renderSection('Color Palette', content, {className: 'bg-transparent border-none p-0'});
        }

        function renderTypography(typography) {
            const families = typography.families.length > 0 ? `<ul class="space-y-2">${typography.families.map(f => `<li class="font-mono text-slate-300 bg-slate-800/50 rounded px-2 py-1 break-words">${f}</li>`).join('')}</ul>` : '<p class="text-slate-400">Not found.</p>';
            const sizes = typography.sizes.length > 0 ? `<ul class="space-y-2">${typography.sizes.map(s => `<li class="font-mono text-slate-300 bg-slate-800/50 rounded px-2 py-1 break-words">${s}</li>`).join('')}</ul>` : '<p class="text-slate-400">Not found.</p>';
            const weights = typography.weights.length > 0 ? `<ul class="space-y-2">${typography.weights.map(w => `<li class="font-mono text-slate-300 bg-slate-800/50 rounded px-2 py-1 break-words">${w}</li>`).join('')}</ul>` : '<p class="text-slate-400">Not found.</p>';
            return `<div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8">
                    ${renderSection('Font Families', families)}
                    ${renderSection('Font Sizes', sizes)}
                    ${renderSection('Font Weights', weights)}</div>`;
        }

        function renderAssets(assets) {
            const images = assets.images.length > 0 ? `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    ${assets.images.map(img => `<div class="bg-slate-800/50 rounded-lg p-2">
                            <img src="${img.src}" alt="${img.alt}" class="w-full h-32 object-contain rounded" onerror="this.parentElement.style.display='none'">
                            <a href="${img.src}" download target="_blank" class="text-blue-400 hover:text-blue-300 text-xs mt-2 block truncate">${img.src.split('/').pop() || 'image'}</a>
                        </div>`).join('')}</div>` : '<p class="text-slate-400">No images found.</p>';
            const svgs = assets.svgs.length > 0 ? `<div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
                    ${assets.svgs.map((svg, i) => `<div class="bg-slate-800/50 rounded-lg p-3 flex flex-col items-center justify-center">
                            <div class="w-full h-24 flex items-center justify-center svg-container" data-svg-html="${btoa(svg.html)}"></div>
                            <a href="${svg.dataUri}" download="icon-${i+1}.svg" class="text-blue-400 hover:text-blue-300 text-xs mt-2 block">Download</a>
                        </div>`).join('')}</div>` : '<p class="text-slate-400">No inline SVGs found.</p>';
            return `<div class="space-y-8">${renderSection('Images', images)} ${renderSection('Inline SVGs', svgs)}</div>`;
        }
        
        function renderTechStack(tech) {
            if (tech.length === 0) return '<p class="text-slate-400">No specific technologies detected.</p>';
            const content = `<div class="flex flex-wrap gap-4">${tech.map(t => `<span class="bg-slate-700 text-slate-200 text-sm font-medium px-3 py-1.5 rounded-full">${t}</span>`).join('')}</div>`;
            return renderSection('Detected Technologies', content, {className: 'bg-transparent border-none p-0'});
        }

        function renderContent(content) {
            const readabilityDesc = score => {
                if (score > 90) return { text: 'Very Easy', color: 'text-green-400' };
                if (score > 70) return { text: 'Easy', color: 'text-green-400' };
                if (score > 50) return { text: 'Fairly Difficult', color: 'text-yellow-400' };
                if (score > 30) return { text: 'Difficult', color: 'text-orange-400' };
                return { text: 'Very Confusing', color: 'text-red-400' };
            }
            const scoreInfo = readabilityDesc(content.readabilityScore);
            return `<div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8">
                ${renderSection('Word Count', `<p class="text-4xl md:text-5xl font-bold text-slate-200">${content.wordCount}</p>`)}
                ${renderSection('Sentence Count', `<p class="text-4xl md:text-5xl font-bold text-slate-200">${content.sentenceCount}</p>`)}
                ${renderSection('Readability Score', `<p class="text-4xl md:text-5xl font-bold ${scoreInfo.color}">${content.readabilityScore}</p><p class="mt-2 text-slate-400">${scoreInfo.text} to read (Flesch-Kincaid)</p>`)}
            </div>`;
        }

        function renderSecurity(security) {
            const checksHtml = security.checks.map(check => {
                const statusIcon = check.present ? 'shield-alert' : 'shield-check';
                const statusColor = check.present ? 'text-red-400' : 'text-green-400';
                return `<div class="flex items-start gap-4 p-4 border-b border-slate-700/50 last:border-b-0">
                    <i data-lucide="${statusIcon}" class="w-6 h-6 ${statusColor} flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-slate-200">${check.name}</h4>
                        <p class="text-sm text-slate-400 mt-1">${check.value}</p>
                        <p class="text-xs text-slate-500 mt-2">${check.recommendation}</p>
                    </div>
                </div>`;
            }).join('');
            return renderSection('HTTP Security', checksHtml, {className: 'p-0'});
        }

        function renderSocial(social) {
            const renderPreview = (platform, data) => {
                const placeholder = 'https://placehold.co/1200x630/1e293b/475569?text=No+Image+Found';
                return `<div class="bg-slate-800/50 rounded-lg overflow-hidden border border-slate-700">
                    <h4 class="p-4 text-lg font-semibold text-slate-200">${platform} Preview</h4>
                    <img src="${data.image || placeholder}" alt="Social Preview" class="w-full aspect-[1.91/1] object-cover border-y border-slate-700" onerror="this.src='${placeholder}'">
                    <div class="p-4">
                        <p class="text-sm text-slate-500 uppercase">${(data.url || 'website.com').split('/')[2]}</p>
                        <h5 class="font-bold text-slate-100 mt-1">${data.title || 'No Title Found'}</h5>
                        <p class="text-slate-400 text-sm mt-1">${data.description || 'No description found.'}</p>
                    </div>
                </div>`;
            }
            return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8">
                ${renderPreview('Facebook (Open Graph)', social.og)}
                ${renderPreview('Twitter Card', social.twitter)}
            </div>`;
        }

        // --- ACTION BUTTONS AND EVENT HANDLERS ---
        function renderActionButtons(report) {
            const downloadArea = $('#download-area');
            if(!downloadArea) return;
            downloadArea.innerHTML = `
                <div class="flex flex-col sm:flex-row gap-2">
                    <button id="download-json-btn" class="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-3 rounded-lg flex items-center justify-center gap-2 focus-ring transition-colors duration-200 text-sm">
                        <i data-lucide="download" class="w-4 h-4"></i><span>JSON</span>
                    </button>
                    <button id="print-report-btn" class="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-3 rounded-lg flex items-center justify-center gap-2 focus-ring transition-colors duration-200 text-sm">
                        <i data-lucide="printer" class="w-4 h-4"></i><span>Print</span>
                    </button>
                </div>
            `;
            lucide.createIcons();
            $('#download-json-btn').addEventListener('click', () => downloadAsJSON(report));
            $('#print-report-btn').addEventListener('click', () => window.print());
        }

        function downloadAsJSON(report) {
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const reportUrl = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = reportUrl;
            a.download = `web-analyzer-report-${slugify(report.url)}.json`;
            a.click();
            URL.revokeObjectURL(reportUrl);
        }

        function injectSvgs() {
            $$('.svg-container').forEach(container => {
                try {
                    const svgHtml = atob(container.dataset.svgHtml);
                    container.innerHTML = svgHtml;
                    const svgElement = container.querySelector('svg');
                    if (svgElement) {
                        svgElement.querySelectorAll('script').forEach(s => s.remove());
                        svgElement.setAttribute('width', '100%'); svgElement.setAttribute('height', '100%');
                    }
                } catch(e) { container.innerHTML = '<p class="text-xs text-red-400">Invalid SVG</p>'; }
            });
        }

        function addTabEventListeners() {
            const tabs = $$('#tabs button');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => {
                        t.classList.remove('border-blue-400', 'text-blue-300');
                        t.classList.add('border-transparent', 'text-slate-400', 'hover:text-slate-200', 'hover:border-slate-500');
                    });
                    $$('.tab-content').forEach(c => c.classList.add('hidden'));
                    tab.classList.add('border-blue-400', 'text-blue-300');
                    tab.classList.remove('border-transparent', 'text-slate-400', 'hover:text-slate-200', 'hover:border-slate-500');
                    $(`#content-${tab.dataset.tab}`)?.classList.remove('hidden');
                });
            });
        }
        
        function addCopyEventListeners() {
            $('#results-state').addEventListener('click', (e) => {
                const copyButton = e.target.closest('.copy-btn');
                if (copyButton) copyToClipboard(copyButton.dataset.copy, copyButton);
            });
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderHistory();
            $('#copyright-year').textContent = new Date().getFullYear();

            $('#analyzeBtn').addEventListener('click', () => analyzeWebsite());
            $('#urlInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') analyzeWebsite(); });
            
            $$('.example-url-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    $('#urlInput').value = btn.textContent;
                    analyzeWebsite();
                });
            });

            $('#history-list').addEventListener('click', (e) => {
                e.preventDefault();
                const link = e.target.closest('.history-item-link');
                const removeBtn = e.target.closest('.remove-history-item');
                
                if (link) {
                    $('#urlInput').value = link.dataset.url;
                    analyzeWebsite(link.dataset.url);
                }
                if (removeBtn) {
                    removeFromHistory(removeBtn.dataset.url);
                }
            });
        });
    </script>
</body>
</html>

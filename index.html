<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ================== ADVANCED SEO & CTR OPTIMIZATION ================== -->
    <!-- New Title: More direct, includes top keywords, and is brand-focused. -->
    <title>Web Analyzer Pro: Free SEO Audit &amp; Website Analysis Tool</title>
    
    <!-- New Description: Action-oriented, uses numbers to build credibility, and has a strong CTA. -->
    <meta name="description" content="Get a free, in-depth SEO audit with Web Analyzer Pro. Instantly analyze your site for 50+ ranking factors, including performance, security, and Core Web Vitals. No sign-up required. Start improving your Google ranking now!">
    
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    
    <!-- Refined Keywords: Based on your provided search query data. -->
    <meta name="keywords" content="website analyzer, seo audit tool, free seo analysis, website performance, core web vitals, technical seo, on-page seo checker, website grader, free seo report, google ranking tool, content analysis, security scanner, tech stack detector">
    
    <meta name="author" content="Web Analyzer Pro">
    <link rel="canonical" href="https://udithkn.github.io/Web-Analyzer-Pro/">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">

    <!-- Open Graph (for social sharing) - Refined for clarity -->
    <meta property="og:title" content="Web Analyzer Pro: Free SEO Audit & Website Analysis Tool">
    <meta property="og:description" content="Instantly run a free, advanced audit on any website for SEO, performance, security, and content issues. Get actionable insights to boost your Google ranking.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://udithkn.github.io/Web-Analyzer-Pro/">
    <!-- You should create and upload these images for optimal social sharing -->
    <meta property="og:image" content="https://udithkn.github.io/Web-Analyzer-Pro/og-image-1200x630.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Web Analyzer Pro">
    
    <!-- Twitter Card - Refined for clarity -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Web Analyzer Pro: Free SEO Audit & Website Analysis Tool">
    <meta name="twitter:description" content="Instantly run a free, advanced audit on any website for SEO, performance, security, and content issues. Get actionable insights to boost your Google ranking.">
    <meta name="twitter:image" content="https://udithkn.github.io/Web-Analyzer-Pro/twitter-image-800x418.png">

    <link rel="icon" type="image/png" href="favicon.png">
    
    <!-- Structured Data (Schema.org) - Refined and expanded for clarity -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "name": "Web Analyzer Pro",
          "url": "https://udithkn.github.io/Web-Analyzer-Pro/",
          "logo": "https://udithkn.github.io/Web-Analyzer-Pro/favicon.png"
        },
        {
          "@type": "WebApplication",
          "name": "Web Analyzer Pro - Free SEO Audit & Website Analysis Tool",
          "description": "A 100% free tool for advanced, in-depth website analysis. Get instant reports on 50+ ranking factors including SEO, performance, Core Web Vitals, accessibility, security, and content. No sign-up required.",
          "applicationCategory": "DeveloperTool",
          "operatingSystem": "Any (Web-based)",
          "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
          "publisher": { "@type": "Organization", "name": "Web Analyzer Pro" },
          "provider": { "@type": "Organization", "name": "Web Analyzer Pro" },
          "audience": { "@type": "Audience", "audienceType": ["Web Developers", "SEO Specialists", "Digital Marketers", "Content Strategists", "Web Designers", "Small Business Owners"] },
          "featureList": [
            "Advanced On-Page SEO Audit (50+ checks)",
            "Website Performance & Core Web Vitals Analysis",
            "Technical SEO Issue Detection",
            "Security Header & Mixed Content Scanning",
            "Content Readability & Keyword Analysis",
            "Accessibility Scanning (WCAG)",
            "Technology Stack Detection",
            "Social Media Share Preview"
          ],
          "url": "https://udithkn.github.io/Web-Analyzer-Pro/",
          "screenshot": "https://udithkn.github.io/Web-Analyzer-Pro/screenshot.jpg"
        },
        {
          "@type": "FAQPage",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "Is Web Analyzer Pro truly free?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Yes, Web Analyzer Pro is 100% free to use. There are no hidden fees, no sign-up requirements, and no credit card needed. You can analyze as many websites as you like, instantly."
              }
            },
            {
              "@type": "Question",
              "name": "What does the advanced SEO audit include?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Our advanced SEO audit covers over 50 critical on-page and technical data points. This includes a full analysis of meta tags (title, description), heading structure (H1-H6), internal/external link profiles, structured data (Schema) validation, canonical tag checks, image alt attributes, and much more."
              }
            },
            {
              "@type": "Question",
              "name": "How does this tool help me rank higher on Google?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "By identifying critical on-page and technical SEO issues, our tool provides a clear, actionable checklist of improvements. Fixing these issues helps your site meet Google's quality guidelines, improve user experience, and demonstrate expertiseâ€”key factors for outperforming competitors and achieving higher search rankings."
              }
            },
            {
              "@type": "Question",
              "name": "How quickly can I see results from this SEO audit?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Our tool provides an instant report with an actionable checklist. By implementing the recommended fixes for critical errors, you can signal positive changes to Google quickly. While major ranking shifts take time, fixing technical issues can often lead to improved crawlability and indexing within weeks."
              }
            }
          ]
        }
      ]
    }
    </script>
    <!-- ================== END SEO OPTIMIZATION ================== -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- Enhanced UI/UX Styles --- */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #020617; /* Darker navy */
            color: #e2e8f0; /* Lighter slate */
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        .focus-ring:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.6); }
        .scrollable-tabs::-webkit-scrollbar { display: none; }
        .scrollable-tabs { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* --- Animations --- */
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader { animation: spin 1s linear infinite; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }

        @keyframes slide-up { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slide-up 0.5s cubic-bezier(0.215, 0.610, 0.355, 1.000) forwards; }

        .animated-card { opacity: 0; } /* Start hidden */
        
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-3px, 0, 0); } 40%, 60% { transform: translate3d(3px, 0, 0); }
        }
        .animate-shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both; }

        .pro-badge {
            background-image: linear-gradient(to right, #2563eb, #7c3aed);
            color: white; font-size: 0.6rem; font-weight: 700;
            padding: 2px 8px; border-radius: 9999px; margin-left: 6px;
            text-transform: uppercase; letter-spacing: 0.8px;
            display: inline-block; vertical-align: middle;
        }
        
        /* Custom gradient for main button */
        .btn-gradient {
            background-image: linear-gradient(to right, #3b82f6, #6366f1);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
            transform: translateY(-2px);
        }

        /* --- Print-specific styles --- */
        @media print {
            body * { visibility: hidden; }
            #results-state, #results-state * { visibility: visible; }
            #results-state { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            #tabs-container, #tab-content-container { border: none !important; }
            .tab-content { display: block !important; page-break-before: always; }
            .tab-content:first-child { page-break-before: auto; }
        }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen flex flex-col lg:flex-row">
        <!-- Sidebar -->
        <aside class="w-full lg:w-96 bg-slate-900/70 backdrop-blur-sm border-r border-slate-800 p-4 sm:p-6 lg:p-8 flex-shrink-0 flex flex-col no-print">
            <div>
                <div class="flex items-center gap-3 mb-8">
                    <img src="favicon.png" alt="Web Analyzer Pro Logo" class="w-9 h-9">
                    <h1 class="text-2xl font-extrabold text-slate-100">Web Analyzer <span class="text-blue-400">Pro</span></h1>
                </div>

                <div class="space-y-6">
                    <div>
                        <label for="urlInput" class="text-sm font-medium text-slate-300 mb-2 block">Enter a Website URL to Audit</label>
                        <div class="relative">
                            <i data-lucide="link-2" class="absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"></i>
                            <input type="url" id="urlInput" placeholder="https://example.com" class="w-full bg-slate-800 border border-slate-700 rounded-lg pl-11 pr-4 py-3 text-slate-100 placeholder-slate-500 focus-ring transition-colors duration-200 focus:border-blue-500">
                        </div>
                    </div>
                    <button id="analyzeBtn" class="w-full btn-gradient text-white font-semibold py-3 px-4 rounded-lg flex items-center justify-center gap-2.5 focus-ring">
                        <i data-lucide="wand-sparkles" class="w-5 h-5"></i>
                        <span>Run Free SEO Audit</span>
                    </button>
                </div>
                
                <div id="message-area" class="mt-6"></div>
                <div id="download-area" class="mt-4 space-y-2"></div>
                
                <div id="history-section" class="mt-8">
                    <h2 class="text-lg font-semibold text-slate-200 mb-3">Recent Analyses</h2>
                    <ul id="history-list" class="space-y-2">
                        <!-- History items will be injected here -->
                    </ul>
                </div>
            </div>
            
            <footer class="mt-auto pt-8 text-center text-xs text-slate-500">
                <p>&copy; <span id="copyright-year"></span> Udith Babu K N. All Rights Reserved.</p>
            </footer>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto bg-slate-950">
            <div id="initial-state" class="h-full flex flex-col items-center justify-center text-center">
                 <div class="relative mb-6">
                     <div class="absolute -inset-2 bg-blue-500/10 rounded-full blur-2xl"></div>
                     <i data-lucide="search-code" class="relative w-24 h-24 text-blue-400"></i>
                 </div>
                 <h1 class="text-4xl font-extrabold text-slate-100 tracking-tight">Uncover SEO Issues That Hurt Your Ranking</h1>
                 <h2 class="text-slate-400 mt-3 max-w-xl font-normal text-lg">Our free tool gives you an actionable report on your website's technical SEO, performance, and security to help you outrank your competition.</h2>
                 <div class="mt-8">
                    <p class="text-slate-500 text-sm mb-3">Or try analyzing a major site:</p>
                    <div class="flex flex-wrap gap-3 justify-center">
                        <button class="example-url-btn bg-slate-800 hover:bg-slate-700 text-slate-300 px-4 py-1.5 rounded-full text-sm transition-all duration-200 hover:text-white hover:scale-105">google.com</button>
                        <button class="example-url-btn bg-slate-800 hover:bg-slate-700 text-slate-300 px-4 py-1.5 rounded-full text-sm transition-all duration-200 hover:text-white hover:scale-105">github.com</button>
                    </div>
                 </div>
            </div>

            <div id="loading-state" class="hidden h-full flex flex-col items-center justify-center">
                <i data-lucide="loader-2" class="w-20 h-20 text-blue-400 loader"></i>
                <p class="text-slate-300 mt-6 text-xl font-semibold">Performing Deep Analysis...</p>
                <div class="w-full max-w-md bg-slate-800 rounded-full h-2.5 mt-4 overflow-hidden">
                    <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
                <p id="loading-status" class="text-slate-400 mt-3 text-sm w-full text-center min-h-[20px]"></p>
            </div>

            <div id="results-state" class="hidden">
                 <div id="report-header" class="mb-6"></div>
                <div id="tabs-container" class="border-b border-slate-800 mb-6 no-print">
                    <nav id="tabs" class="-mb-px flex space-x-2 sm:space-x-4 overflow-x-auto scrollable-tabs" aria-label="Tabs"></nav>
                </div>
                <div id="tab-content-container"></div>
            </div>
        </main>
    </div>

    <script>
        // --- UTILITY AND HELPER FUNCTIONS ---
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-').replace(/[^\w-]+/g, '')
                .replace(/--+/g, '-').replace(/^-+/, '').replace(/-+$/, '');
        }

        async function fetchWithProxy(url) {
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxyUrl, { signal: AbortSignal.timeout(20000) }); // Increased timeout
                if (!response.ok) throw new Error(`Request failed with status: ${response.status}`);
                const data = await response.text();
                if (!data || data.includes("The service is temporarily unavailable") || data.includes("error code: 1020")) {
                    throw new Error("The CORS proxy service returned an error or the site is protected by Cloudflare. Please try again or use a different URL.");
                }
                return data;
            } catch (error) {
                console.error('Fetch failed:', error);
                if (error.name === 'TimeoutError') {
                     throw new Error("The request timed out. The server might be slow or offline. Please try again.");
                }
                throw new Error(error.message || "We couldn't analyze that URL. This can happen if the site is offline, has strong anti-bot protection, or the request timed out. Please try another site.");
            }
        }

        function copyToClipboard(text, element) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed'; textArea.style.opacity = 0;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                const originalContent = element.innerHTML;
                element.innerHTML = '<i data-lucide="check" class="w-4 h-4 text-green-400"></i> <span class="text-green-400">Copied!</span>';
                lucide.createIcons();
                setTimeout(() => { element.innerHTML = originalContent; lucide.createIcons(); }, 1500);
            } catch (err) { console.error('Failed to copy text: ', err); }
            document.body.removeChild(textArea);
        }
        
        function showMessage(message, type = 'error') {
            const messageArea = $('#message-area');
            const colors = {
                error: 'bg-red-900/50 border-red-500/30 text-red-300',
                warning: 'bg-yellow-900/50 border-yellow-500/30 text-yellow-300',
                retry: 'bg-blue-900/50 border-blue-500/30 text-blue-300'
            };
            const icons = { error: 'alert-triangle', warning: 'alert-circle', retry: 'refresh-cw' };
            const animationClass = type === 'retry' ? 'animate-shake' : '';

            messageArea.innerHTML = `
                <div class="p-4 rounded-lg border ${colors[type]} flex items-start gap-3 ${animationClass}">
                    <i data-lucide="${icons[type]}" class="w-5 h-5 flex-shrink-0 mt-0.5"></i>
                    <p class="text-sm">${message}</p>
                </div>`;
            lucide.createIcons();
        }
        
        function updateLoadingStatus(text, progress) {
            $('#loading-status').textContent = text;
            $('#progress-bar').style.width = `${progress}%`;
        }

        // --- ANALYSIS HISTORY (LOCALSTORAGE) ---
        function getHistory() { return JSON.parse(localStorage.getItem('analysisHistory') || '[]'); }
        function saveToHistory(url) {
            let history = getHistory();
            const cleanUrl = url.replace(/^https?:\/\//, '').replace(/\/$/, '');
            history = history.filter(item => item !== cleanUrl);
            history.unshift(cleanUrl);
            localStorage.setItem('analysisHistory', JSON.stringify(history.slice(0, 5)));
            renderHistory();
        }
        function renderHistory() {
            const history = getHistory();
            const list = $('#history-list');
            if (!list) return;
            if (history.length === 0) {
                list.innerHTML = `<li class="text-slate-500 text-sm px-2">No recent analyses.</li>`;
                return;
            }
            list.innerHTML = history.map(url => `
                <li class="flex items-center justify-between group rounded-md hover:bg-slate-800/50">
                    <a href="#" class="history-item-link text-slate-400 hover:text-blue-300 text-sm truncate flex-1 py-1.5 px-2" data-url="${url}">${url}</a>
                    <button class="remove-history-item opacity-0 group-hover:opacity-100 transition-opacity p-2" data-url="${url}">
                        <i data-lucide="x" class="w-4 h-4 text-slate-500 hover:text-red-400"></i>
                    </button>
                </li>
            `).join('');
            lucide.createIcons();
        }
        function removeFromHistory(url) {
             let history = getHistory();
             history = history.filter(item => item !== url);
             localStorage.setItem('analysisHistory', JSON.stringify(history));
             renderHistory();
        }

        // --- CORE ANALYSIS LOGIC ---
        async function analyzeWebsite(urlToAnalyze) {
            const url = urlToAnalyze || $('#urlInput').value.trim();
            if (!url) {
                showMessage('Please enter a website URL.');
                return;
            }
            const fullUrl = url.match(/^https?:\/\//) ? url : `https://${url}`;
            $('#urlInput').value = fullUrl;

            $('#message-area').innerHTML = '';
            $('#download-area').innerHTML = '';
            $('#initial-state').classList.add('hidden');
            $('#results-state').classList.add('hidden');
            $('#loading-state').classList.remove('hidden');

            const loadingMessages = [
                "Fetching website content...", "Parsing HTML structure...", "Analyzing styles and assets...",
                "Detecting technology stack...", "Auditing on-page SEO...", "Checking heading structure...",
                "Scanning for accessibility issues...", "Analyzing performance metrics...", "Checking security headers...",
                "Finalizing report..."
            ];
            let messageIndex = 0;
            const messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                updateLoadingStatus(loadingMessages[messageIndex], (messageIndex + 1) * (100 / loadingMessages.length));
            }, 1200);

            try {
                const html = await fetchWithProxy(fullUrl);
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const baseURL = new URL(fullUrl).origin;

                const analysisModules = {
                    colors: () => extractColors(doc),
                    typography: () => extractTypography(doc),
                    assets: () => extractAssets(doc, baseURL),
                    techStack: () => detectTechStack(doc, html),
                    seo: () => extractSeoData(doc),
                    accessibility: () => checkAccessibility(doc),
                    performance: () => checkPerformance(doc, html),
                    content: () => analyzeContent(doc),
                    security: () => analyzeSecurity(doc),
                    social: () => analyzeSocial(doc),
                };

                const fullReport = { url: fullUrl, generatedAt: new Date().toISOString() };
                for (const [key, func] of Object.entries(analysisModules)) {
                    fullReport[key] = await func();
                }
                
                clearInterval(messageInterval);
                updateLoadingStatus('Generating report...', 100);
                
                setTimeout(() => { // Short delay for smoother transition
                    renderResults(fullReport);
                    saveToHistory(fullUrl);
                    $('#loading-state').classList.add('hidden');
                    $('#results-state').classList.remove('hidden');
                }, 300);

            } catch (error) {
                clearInterval(messageInterval);
                console.error('Analysis failed:', error);
                showMessage(error.message, 'retry');
                $('#loading-state').classList.add('hidden');
                $('#initial-state').classList.remove('hidden');
                updateLoadingStatus('', 0);
            }
        }
        
        // --- EXTRACTION & ANALYSIS MODULES (Refined) ---
        function extractColors(doc) {
            const colors = new Set();
            const colorRegex = /(#[0-9a-f]{3,8}|(rgba?|hsla?)\([^)]+\))/gi;
            doc.querySelectorAll('[style]').forEach(el => el.getAttribute('style').match(colorRegex)?.forEach(c => colors.add(c.toLowerCase())));
            doc.querySelectorAll('style').forEach(styleTag => styleTag.innerHTML.match(colorRegex)?.forEach(c => colors.add(c.toLowerCase())));
            return { palette: Array.from(colors) };
        }

        function extractTypography(doc) {
            const fontDetails = { families: new Set(), sizes: new Set(), weights: new Set() };
            const regexes = {
                families: /font-family:([^;]+)/gi,
                sizes: /font-size:([^;]+)/gi,
                weights: /font-weight:([^;]+)/gi
            };
            function parseStyle(styleText) {
                let match;
                while((match = regexes.families.exec(styleText)) !== null) match[1].split(',').forEach(f => fontDetails.families.add(f.trim().replace(/['"]/g, '')));
                while((match = regexes.sizes.exec(styleText)) !== null) fontDetails.sizes.add(match[1].trim());
                while((match = regexes.weights.exec(styleText)) !== null) fontDetails.weights.add(match[1].trim());
            }
            doc.querySelectorAll('[style]').forEach(el => parseStyle(el.getAttribute('style')));
            doc.querySelectorAll('style').forEach(styleTag => parseStyle(styleTag.innerHTML));
            return { families: Array.from(fontDetails.families), sizes: Array.from(fontDetails.sizes), weights: Array.from(fontDetails.weights) };
        }

        function extractAssets(doc, baseURL) {
            const assets = { images: [], svgs: [] };
            doc.querySelectorAll('img').forEach(img => {
                if (img.src) {
                    try { assets.images.push({ src: new URL(img.src, baseURL).href, alt: img.alt || 'Missing' }); } catch(e) {}
                }
            });
            doc.querySelectorAll('svg').forEach(svg => {
                const svgHtml = svg.outerHTML;
                const dataUri = `data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(svgHtml)))}`;
                assets.svgs.push({ html: svgHtml, dataUri });
            });
            return assets;
        }

        function detectTechStack(doc, html) {
            const tech = new Set();
            const detections = {
                'React': () => doc.querySelector('[data-reactroot], #___gatsby, #__next'),
                'Vue.js': () => doc.querySelector('#app[data-v-app], [data-v-app]'),
                'Angular': () => doc.querySelector('[ng-version]'),
                'Svelte': () => doc.querySelector('.svelte-app') || html.includes('__svelte__'),
                'jQuery': () => html.includes('jquery.js') || html.includes('jquery.min.js'),
                'WordPress': () => html.includes('wp-content/') || html.includes('wp-json/'),
                'Shopify': () => html.includes('cdn.shopify.com'),
                'Bootstrap': () => doc.querySelector('link[href*="bootstrap"], div[class*="col-"]'),
                'Tailwind CSS': () => doc.querySelector('link[href*="tailwind"], style[id*="tailwind"]') || html.includes('className:'),
                'GSAP': () => html.includes('gsap.min.js'),
                'Google Analytics': () => html.includes('google-analytics.com/analytics.js') || html.includes('googletagmanager.com/gtag/js'),
                'Chart.js': () => html.includes('Chart.min.js') || html.includes('chart.js'),
            };
            for (const [name, detector] of Object.entries(detections)) {
                try { if (detector()) tech.add(name); } catch (e) {}
            }
            return Array.from(tech);
        }

        function extractSeoData(doc) {
            const getMeta = (name) => doc.querySelector(`meta[name="${name}"], meta[property="og:${name}"]`)?.content || null;
            const headings = {};
            ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].forEach(h => {
                headings[h] = Array.from(doc.querySelectorAll(h)).map(el => el.textContent.trim());
            });
            const links = { internal: 0, external: 0, nofollow: 0 };
            const pageHost = new URL(doc.baseURI).hostname;
            doc.querySelectorAll('a[href]').forEach(a => {
                try {
                    if (!a.href.startsWith('http')) return;
                    const linkHost = new URL(a.href).hostname;
                    if (linkHost === pageHost) links.internal++; else links.external++;
                    if (a.rel.includes('nofollow')) links.nofollow++;
                } catch(e) {}
            });
            const structuredData = Array.from(doc.querySelectorAll('script[type="application/ld+json"]')).map(s => s.innerHTML);
            
            return {
                title: doc.title || null,
                description: getMeta('description'),
                keywords: getMeta('keywords'),
                canonical: doc.querySelector('link[rel="canonical"]')?.href || null,
                headings, links, structuredData
            };
        }

        function checkPerformance(doc, html) {
            const scripts = Array.from(doc.querySelectorAll('script[src]'));
            const stylesheets = Array.from(doc.querySelectorAll('link[rel="stylesheet"]'));
            const images = Array.from(doc.querySelectorAll('img'));
            const cdnHosts = ['cdn.', 'cdnjs.cloudflare.com', 'maxcdn.bootstrapcdn.com', 'unpkg.com', 'jsdelivr.net', 'fonts.googleapis.com'];
            const cdnUsage = [...scripts, ...stylesheets].some(res => cdnHosts.some(cdn => res.href?.includes(cdn) || res.src?.includes(cdn)));
            const unoptimizedImages = images.filter(img => (!img.loading || img.loading !== 'lazy') && !img.src.startsWith('data:')).length;

            return {
                requestCounts: { totalJS: scripts.length, totalCSS: stylesheets.length, totalImages: images.length },
                scripts: scripts.map(s => ({ src: s.src, async: s.async, defer: s.defer })),
                htmlSize: { raw: html.length, formatted: `${(html.length / 1024).toFixed(2)} KB` },
                cdnUsage, unoptimizedImages
            };
        }

        function checkAccessibility(doc) {
            const issues = [];
            doc.querySelectorAll('img:not([alt])').forEach((img) => issues.push({ type: 'Warning', check: 'Image Alt Text', issue: `Image is missing an alt attribute.`, element: img.outerHTML }));
            doc.querySelectorAll('a:not([aria-label]):not([aria-labelledby])').forEach((a) => {
                if (!a.innerText.trim() && !a.querySelector('img[alt]')) {
                     issues.push({ type: 'Warning', check: 'Link Text', issue: `Link has no discernible text.`, element: a.outerHTML });
                }
            });
            doc.querySelectorAll('input:not([type=hidden]), textarea, select').forEach((input) => {
                if(!input.id || !doc.querySelector(`label[for="${input.id}"]`)) {
                    issues.push({ type: 'Warning', check: 'Form Labels', issue: `Input element may be missing an associated label.`, element: input.outerHTML });
                }
            });
            if (!doc.documentElement.lang) {
                issues.push({ type: 'Error', check: 'Language Attribute', issue: 'The <html> tag is missing a "lang" attribute.', element: '<html>' });
            }
            return { issues };
        }

        function analyzeContent(doc) {
            const textContent = doc.body.innerText || "";
            const words = textContent.match(/\b\w+\b/g) || [];
            const sentences = textContent.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const syllables = (textContent.match(/[aeiouy]{1,2}/gi) || []).length;
            const wordCount = words.length;
            const sentenceCount = sentences.length;
            let readabilityScore = 0;
            if (wordCount > 100 && sentenceCount > 0) {
                readabilityScore = 206.835 - 1.015 * (wordCount / sentenceCount) - 84.6 * (syllables / wordCount);
            }
            return { wordCount, sentenceCount, readabilityScore: Math.round(readabilityScore) };
        }

        function analyzeSecurity(doc) {
            const checks = [];
            const csp = doc.querySelector('meta[http-equiv="Content-Security-Policy"]');
            checks.push({ name: 'Content Security Policy (CSP)', present: !!csp, value: csp ? 'Detected' : 'Not Found', recommendation: 'A strong CSP helps prevent Cross-Site Scripting (XSS) attacks.' });
            const mixedContent = Array.from(doc.querySelectorAll('img[src^="http:"], script[src^="http:"], link[href^="http:"]'));
            checks.push({ name: 'Mixed Content', present: mixedContent.length > 0, value: `${mixedContent.length} insecure assets found`, recommendation: 'Serve all assets over HTTPS to prevent security warnings and protect users.' });
            return { checks };
        }
        
        function analyzeSocial(doc) {
            const getMeta = (prop) => doc.querySelector(`meta[property="${prop}"], meta[name="${prop}"]`)?.content || null;
            return {
                og: { title: getMeta('og:title'), description: getMeta('og:description'), image: getMeta('og:image'), url: getMeta('og:url') },
                twitter: { card: getMeta('twitter:card'), title: getMeta('twitter:title'), description: getMeta('twitter:description'), image: getMeta('twitter:image') }
            };
        }


        // --- REPORT RENDERING (New Design) ---
        function renderResults(report) {
            const tabsContainer = $('#tabs');
            const contentContainer = $('#tab-content-container');
            tabsContainer.innerHTML = '';
            contentContainer.innerHTML = '';
            
            const tabs = {
                'Overview': { icon: 'layout-dashboard', content: renderOverview(report) },
                'SEO': { icon: 'siren', content: renderSeo(report.seo) },
                'Performance': { icon: 'gauge-circle', content: renderPerformance(report.performance) },
                'Accessibility': { icon: 'person-standing', content: renderAccessibility(report.accessibility) },
                'Security': { icon: 'shield', content: renderSecurity(report.security), pro: true },
                'Social': { icon: 'share-2', content: renderSocial(report.social), pro: true },
                'Tech Stack': { icon: 'cpu', content: renderTechStack(report.techStack) },
                'Assets': { icon: 'image', content: renderAssets(report.assets) },
            };

            Object.entries(tabs).forEach(([name, data], index) => {
                const tabId = slugify(name);
                const button = document.createElement('button');
                button.className = `flex-shrink-0 flex items-center gap-2 px-3 py-3 text-sm font-medium border-b-2 transition-all duration-200 rounded-t-md ${index === 0 ? 'border-blue-500 text-white bg-slate-800/50' : 'border-transparent text-slate-400 hover:text-white hover:bg-slate-800/30'}`;
                button.innerHTML = `<i data-lucide="${data.icon}" class="w-5 h-5"></i><span>${name}</span> ${data.pro ? '<span class="pro-badge">Pro</span>' : ''}`;
                button.dataset.tab = tabId;
                tabsContainer.appendChild(button);

                const contentDiv = document.createElement('div');
                contentDiv.className = `tab-content ${index > 0 ? 'hidden' : ''}`;
                contentDiv.id = `content-${tabId}`;
                contentDiv.innerHTML = data.content;
                contentContainer.appendChild(contentDiv);
            });
            
            renderReportHeader(report);
            if (tabs.Overview) renderHealthChart(report);

            renderActionButtons(report);
            lucide.createIcons();
            addTabEventListeners();
            addCopyEventListeners();
            injectSvgs();
            
            $$('#results-state .animated-card').forEach((card, i) => {
                setTimeout(() => {
                    card.style.opacity = '0'; // ensure it's hidden before animation
                    card.classList.add('slide-up');
                }, i * 80);
            });
        }
        
        function renderReportHeader(report) {
            const header = $('#report-header');
            const totalScore = calculateOverallScore(report);
            const scoreColor = totalScore > 89 ? 'text-green-400' : totalScore > 49 ? 'text-yellow-400' : 'text-red-400';

            header.innerHTML = `
                <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-4">
                    <div>
                        <p class="text-sm text-slate-400">Analysis Report for:</p>
                        <a href="${report.url}" target="_blank" rel="noopener noreferrer" class="text-xl font-bold text-blue-400 hover:underline">${report.url}</a>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-slate-400">Overall Score</p>
                        <p class="text-5xl font-extrabold ${scoreColor}">${totalScore}</p>
                    </div>
                </div>`;
        }
        
        function calculateOverallScore(report) {
            const scores = {
                seo: Math.max(0, 100 - ((report.seo.headings.h1?.length !== 1 ? 1 : 0) * 15 + (!report.seo.description ? 1 : 0) * 10)),
                performance: Math.max(0, 100 - (report.performance.scripts.filter(s => !s.async && !s.defer).length * 5 + report.performance.unoptimizedImages * 5)),
                accessibility: Math.max(0, 100 - report.accessibility.issues.length * 5),
                security: Math.max(0, 100 - report.security.checks.filter(c => c.present).length * 25)
            };
            return Math.round((scores.seo + scores.performance + scores.accessibility + scores.security) / 4);
        }

        function renderSection(title, content, options = {}) {
            return `<div class="bg-slate-900 border border-slate-800 rounded-xl ${options.className || 'p-4 md:p-6'}">
                        <h3 class="text-lg font-bold text-slate-100 mb-4 flex items-center gap-2">${options.icon ? `<i data-lucide="${options.icon}" class="w-5 h-5 text-slate-400"></i>` : ''}${title}</h3>
                        <div class="text-slate-300">${content}</div>
                    </div>`;
        }
        
        function renderScoreCard(title, score, description, icon) {
            const scoreColor = score > 89 ? 'text-green-400' : score > 49 ? 'text-yellow-400' : 'text-red-400';
            const ringColor = score > 89 ? 'stroke-green-500' : score > 49 ? 'stroke-yellow-500' : 'stroke-red-500';
            const progress = (score / 100) * 2 * Math.PI * 20; // 20 is radius
            return `<div class="bg-slate-900 border border-slate-800 p-4 rounded-xl flex items-center gap-4">
                        <div class="relative w-16 h-16 flex-shrink-0">
                            <svg class="w-full h-full" viewBox="0 0 44 44">
                                <circle class="stroke-slate-700" cx="22" cy="22" r="20" stroke-width="3" fill="transparent"></circle>
                                <circle class="${ringColor}" cx="22" cy="22" r="20" stroke-width="3" fill="transparent" stroke-dasharray="${progress} 999" transform="rotate(-90 22 22)"></circle>
                            </svg>
                            <span class="absolute inset-0 flex items-center justify-center text-xl font-bold ${scoreColor}">${score}</span>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-100">${title}</h4>
                            <p class="text-slate-400 text-sm">${description}</p>
                        </div>
                    </div>`;
        }

        function renderOverview(report) {
            const scores = {
                seo: Math.max(0, 100 - ((report.seo.headings.h1?.length !== 1 ? 1 : 0) * 15 + (!report.seo.description ? 1 : 0) * 10)),
                performance: Math.max(0, 100 - (report.performance.scripts.filter(s => !s.async && !s.defer).length * 5 + report.performance.unoptimizedImages * 5)),
                accessibility: Math.max(0, 100 - report.accessibility.issues.length * 5),
                security: Math.max(0, 100 - report.security.checks.filter(c => c.present).length * 25)
            };
            
            return `<div class="grid grid-cols-1 lg:grid-cols-5 gap-6 animated-card">
                        <div class="lg:col-span-3 bg-slate-900 border border-slate-800 p-4 md:p-6 rounded-xl">
                            <h3 class="text-lg font-bold text-slate-100 mb-4">Website Health Radar</h3>
                            <div class="h-64 sm:h-80 w-full"><canvas id="healthChart"></canvas></div>
                        </div>
                        <div class="lg:col-span-2 grid grid-cols-1 gap-4">
                            ${renderScoreCard('SEO Score', scores.seo, `${(report.seo.headings.h1?.length !== 1 ? 1 : 0) + (!report.seo.description ? 1 : 0)} critical issues.`)}
                            ${renderScoreCard('Performance', scores.performance, `${report.performance.scripts.filter(s => !s.async && !s.defer).length + report.performance.unoptimizedImages} optimizations.`)}
                            ${renderScoreCard('Accessibility', scores.accessibility, `${report.accessibility.issues.length} issues found.`)}
                            ${renderScoreCard('Security', scores.security, `${report.security.checks.filter(c => c.present).length} risks found.`)}
                        </div>
                    </div>`;
        }
        
        function renderHealthChart(report) {
            const ctx = $('#healthChart')?.getContext('2d');
            if (!ctx) return;
            const scores = {
                seo: Math.max(0, 100 - ((report.seo.headings.h1?.length !== 1 ? 1 : 0) * 15 + (!report.seo.description ? 1 : 0) * 10)),
                performance: Math.max(0, 100 - (report.performance.scripts.filter(s => !s.async && !s.defer).length * 5 + report.performance.unoptimizedImages * 5)),
                accessibility: Math.max(0, 100 - report.accessibility.issues.length * 5),
                security: Math.max(0, 100 - report.security.checks.filter(c => c.present).length * 25)
            };

            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['SEO', 'Performance', 'Accessibility', 'Security'],
                    datasets: [{
                        label: 'Health Score',
                        data: [scores.seo, scores.performance, scores.accessibility, scores.security],
                        fill: true,
                        backgroundColor: 'rgba(96, 165, 250, 0.2)',
                        borderColor: 'rgba(96, 165, 250, 1)',
                        pointBackgroundColor: 'rgba(96, 165, 250, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(96, 165, 250, 1)'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            pointLabels: { color: '#cbd5e1', font: { size: 14, weight: '500' } },
                            ticks: { display: false, stepSize: 25 },
                            min: 0, max: 100
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function renderSeo(seo) {
             const renderRow = (label, value, status, icon) => {
                const statusColor = status === 'good' ? 'text-green-400' : status === 'bad' ? 'text-red-400' : 'text-slate-300';
                const statusIcon = status === 'good' ? 'check-circle-2' : status === 'bad' ? 'x-circle' : 'info';
                return `<li class="flex items-start justify-between py-3">
                            <span class="text-slate-400 text-sm">${label}</span>
                            <span class="font-semibold ${statusColor} text-right break-words max-w-[60%] flex items-center gap-2">
                                <i data-lucide="${statusIcon}" class="w-4 h-4 flex-shrink-0"></i>
                                <span>${value || 'Not found'}</span>
                            </span>
                        </li>`;
            }
            const h1Count = seo.headings.h1?.length || 0;
            const headingsHtml = Object.entries(seo.headings).map(([tag, list]) => list.length > 0 ? `<div class="mt-2"><h4 class="font-semibold text-slate-300">${tag.toUpperCase()} (${list.length})</h4><ul class="list-disc list-inside pl-2 text-slate-400 text-sm break-words">${list.map(h => `<li>${h}</li>`).join('')}</ul></div>` : '').join('');
            const structuredDataHtml = seo.structuredData.map((data, i) => {
                try { return `<pre class="bg-slate-950 p-3 rounded-md text-xs text-slate-300 overflow-auto mt-1"><code>${JSON.stringify(JSON.parse(data), null, 2)}</code></pre>` } catch(e) { return '' }
            }).join('');
            
            return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                ${renderSection('On-Page SEO Status', `
                    <ul class="divide-y divide-slate-800">
                        ${renderRow('Title Tag', seo.title, seo.title && seo.title.length < 60 ? 'good' : 'bad')}
                        ${renderRow('Meta Description', seo.description, seo.description && seo.description.length < 160 ? 'good' : 'bad')}
                        ${renderRow('H1 Tag', `${h1Count} found`, h1Count === 1 ? 'good' : 'bad')}
                        ${renderRow('Canonical URL', seo.canonical, seo.canonical ? 'good' : 'bad')}
                    </ul>
                `, {icon: 'file-check'})}
                ${renderSection('Heading Structure', headingsHtml || '<p class="text-slate-400">No headings found.</p>', {icon: 'list-ordered'})}
                ${renderSection('Link Analysis', `
                    <ul class="space-y-3 text-slate-300">
                        <li class="flex justify-between items-center"><span>Internal Links:</span><span class="font-bold text-xl">${seo.links.internal}</span></li>
                        <li class="flex justify-between items-center"><span>External Links:</span><span class="font-bold text-xl">${seo.links.external}</span></li>
                        <li class="flex justify-between items-center"><span>Nofollow Links:</span><span class="font-bold text-xl">${seo.links.nofollow}</span></li>
                    </ul>`, {icon: 'link'})}
                ${renderSection('Structured Data (Schema)', structuredDataHtml || '<p class="text-slate-400">No structured data found.</p>', {icon: 'code-2'})}
            </div>`;
        }

        function renderPerformance(perf) {
            const renderRow = (label, value, status) => {
                const statusColor = status === 'good' ? 'text-green-400' : status === 'bad' ? 'text-red-400' : 'text-slate-300';
                return `<li class="flex justify-between items-center py-2.5"><span class="text-slate-400">${label}</span><span class="font-bold ${statusColor}">${value}</span></li>`;
            }
            return `<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                ${renderSection('Core Metrics', `
                    <ul class="divide-y divide-slate-800">
                        ${renderRow('JavaScript Files', perf.requestCounts.totalJS, perf.requestCounts.totalJS < 10 ? 'good' : 'bad')}
                        ${renderRow('CSS Files', perf.requestCounts.totalCSS, perf.requestCounts.totalCSS < 5 ? 'good' : 'bad')}
                        ${renderRow('Image Files', perf.requestCounts.totalImages)}
                        ${renderRow('HTML Size', perf.htmlSize.formatted, perf.htmlSize.raw < 100000 ? 'good' : 'bad')}
                        ${renderRow('Lazy-loaded Images', `${perf.requestCounts.totalImages - perf.unoptimizedImages} / ${perf.requestCounts.totalImages}`, perf.unoptimizedImages === 0 ? 'good' : 'bad')}
                    </ul>`, {icon: 'timer'})}
                ${renderSection('Recommendations', `
                    <ul class="space-y-4">
                        <li class="flex items-start gap-3"><i data-lucide="${perf.cdnUsage ? 'check-circle' : 'x-circle'}" class="w-5 h-5 mt-0.5 ${perf.cdnUsage ? 'text-green-400' : 'text-yellow-400'}"></i><div><h4 class="font-semibold text-slate-100">Use a CDN</h4><p class="text-sm text-slate-400">${perf.cdnUsage ? 'Good, assets are served from a CDN.' : 'Consider using a CDN for faster global delivery.'}</p></div></li>
                        <li class="flex items-start gap-3"><i data-lucide="${perf.scripts.every(s => s.async || s.defer) ? 'check-circle' : 'x-circle'}" class="w-5 h-5 mt-0.5 ${perf.scripts.every(s => s.async || s.defer) ? 'text-green-400' : 'text-red-400'}"></i><div><h4 class="font-semibold text-slate-100">Async/Defer Scripts</h4><p class="text-sm text-slate-400">${perf.scripts.filter(s => !s.async && !s.defer).length} scripts could be deferred to prevent render-blocking.</p></div></li>
                    </ul>`, {icon: 'rocket'})}
            </div>`;
        }
        
        function renderAccessibility(accessibility) {
            if (accessibility.issues.length === 0) {
                return `<div class="flex items-center gap-4 bg-green-900/50 text-green-300 p-6 rounded-xl"><i data-lucide="check-circle-2" class="w-10 h-10"></i><div><h3 class="text-lg font-bold">Excellent!</h3><p>No basic accessibility issues found. This is great for user experience.</p></div></div>`;
            }
            const renderIssue = issue => {
                const colors = { Warning: 'border-yellow-500/50 bg-yellow-900/20 text-yellow-300', Error: 'border-red-500/50 bg-red-900/20 text-red-300' };
                return `<div class="border-l-4 p-4 rounded-r-lg ${colors[issue.type]}">
                            <p class="font-semibold">${issue.check}: ${issue.issue}</p>
                            <code class="text-xs text-slate-400/80 mt-2 block bg-black/30 p-2 rounded break-all overflow-x-auto">${issue.element.replace(/</g, '&lt;')}</code>
                        </div>`;
            }
            return `<div class="space-y-4">${accessibility.issues.map(renderIssue).join('')}</div>`;
        }

        function renderSecurity(security) {
            const checksHtml = security.checks.map(check => {
                const isGood = !check.present;
                const statusIcon = isGood ? 'shield-check' : 'shield-alert';
                const statusColor = isGood ? 'text-green-400' : 'text-red-400';
                return `<div class="flex items-start gap-4 p-4 border-b border-slate-800 last:border-b-0">
                    <i data-lucide="${statusIcon}" class="w-6 h-6 ${statusColor} flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-slate-100">${check.name}</h4>
                        <p class="text-sm ${isGood ? 'text-slate-400' : statusColor} mt-1">${check.value}</p>
                        <p class="text-xs text-slate-500 mt-2">${check.recommendation}</p>
                    </div>
                </div>`;
            }).join('');
            return renderSection('Security Headers', checksHtml, {className: 'p-0'});
        }

        function renderSocial(social) {
            const renderPreview = (platform, data) => {
                const placeholder = `https://placehold.co/1200x630/0f172a/475569?text=No+${platform}+Image`;
                return `<div class="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden">
                    <h4 class="p-4 text-lg font-bold text-slate-100">${platform} Preview</h4>
                    <img src="${data.image || placeholder}" alt="${platform} Preview" class="w-full aspect-[1.91/1] object-cover border-y border-slate-800 bg-slate-800" onerror="this.src='${placeholder}'; this.onerror=null;">
                    <div class="p-4">
                        <p class="text-sm text-slate-500 uppercase">${(data.url || 'website.com').split('/')[2]}</p>
                        <h5 class="font-bold text-slate-100 mt-1 truncate">${data.title || 'No Title Found'}</h5>
                        <p class="text-slate-400 text-sm mt-1 h-10 overflow-hidden">${data.description || 'No description found.'}</p>
                    </div>
                </div>`;
            }
            return `<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                ${renderPreview('Facebook (Open Graph)', social.og)}
                ${renderPreview('Twitter Card', social.twitter)}
            </div>`;
        }

        function renderTechStack(tech) {
            if (tech.length === 0) return '<p class="text-slate-400">No specific technologies detected.</p>';
            const content = `<div class="flex flex-wrap gap-3">${tech.map(t => `<span class="bg-slate-800 text-slate-200 text-sm font-medium px-4 py-2 rounded-full flex items-center gap-2"><i data-lucide="cpu" class="w-4 h-4 text-blue-400"></i>${t}</span>`).join('')}</div>`;
            return content;
        }

        function renderAssets(assets) {
            const images = assets.images.length > 0 ? `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    ${assets.images.map(img => `<div class="bg-slate-900 border border-slate-800 rounded-lg p-3 group">
                            <div class="w-full h-32 bg-slate-800/50 rounded-md flex items-center justify-center overflow-hidden">
                                <img src="${img.src}" alt="${img.alt}" class="max-w-full max-h-full object-contain" onerror="this.parentElement.innerHTML='<i data-lucide=image-off class=w-8 h-8 text-slate-500></i>'">
                            </div>
                            <p class="text-xs text-slate-400 mt-2">Alt: <span class="${img.alt === 'Missing' ? 'text-red-400' : 'text-slate-300'}">${img.alt}</span></p>
                            <a href="${img.src}" download target="_blank" class="text-blue-400 hover:underline text-xs mt-1 block truncate">${img.src.split('/').pop() || 'image'}</a>
                        </div>`).join('')}</div>` : '<p class="text-slate-400">No images found.</p>';
            const svgs = assets.svgs.length > 0 ? `<div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
                    ${assets.svgs.map((svg, i) => `<div class="bg-slate-900 border border-slate-800 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
                            <div class="w-full h-full flex items-center justify-center svg-container" data-svg-html="${btoa(unescape(encodeURIComponent(svg.html)))}"></div>
                            <a href="${svg.dataUri}" download="icon-${i+1}.svg" class="text-blue-400 hover:underline text-xs mt-2 block">Download</a>
                        </div>`).join('')}</div>` : '<p class="text-slate-400">No inline SVGs found.</p>';
            return `<div class="space-y-8">${renderSection('Images', images, {icon: 'image'})} ${renderSection('Inline SVGs', svgs, {icon: 'figma'})}</div>`;
        }

        // --- ACTION BUTTONS AND EVENT HANDLERS ---
        function renderActionButtons(report) {
            const downloadArea = $('#download-area');
            if(!downloadArea) return;
            downloadArea.innerHTML = `
                <div class="flex flex-col sm:flex-row gap-2">
                    <button id="download-json-btn" class="flex-1 bg-slate-700/50 hover:bg-slate-700 text-slate-200 font-semibold py-2 px-3 rounded-lg flex items-center justify-center gap-2 focus-ring transition-colors duration-200 text-sm">
                        <i data-lucide="download-cloud" class="w-4 h-4"></i><span>Download JSON</span>
                    </button>
                    <button id="print-report-btn" class="flex-1 bg-slate-700/50 hover:bg-slate-700 text-slate-200 font-semibold py-2 px-3 rounded-lg flex items-center justify-center gap-2 focus-ring transition-colors duration-200 text-sm">
                        <i data-lucide="printer" class="w-4 h-4"></i><span>Print Report</span>
                    </button>
                </div>
            `;
            lucide.createIcons();
            $('#download-json-btn').addEventListener('click', () => downloadAsJSON(report));
            $('#print-report-btn').addEventListener('click', () => window.print());
        }

        function downloadAsJSON(report) {
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const reportUrl = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = reportUrl;
            a.download = `web-analyzer-pro-report-${slugify(report.url)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(reportUrl);
        }

        function injectSvgs() {
            $$('.svg-container').forEach(container => {
                try {
                    const svgHtml = decodeURIComponent(escape(atob(container.dataset.svgHtml)));
                    container.innerHTML = svgHtml;
                    const svgElement = container.querySelector('svg');
                    if (svgElement) {
                        svgElement.querySelectorAll('script').forEach(s => s.remove());
                        svgElement.setAttribute('width', '100%'); svgElement.setAttribute('height', '100%');
                        svgElement.style.fill = 'currentColor';
                    }
                } catch(e) { container.innerHTML = '<p class="text-xs text-red-400">Invalid SVG</p>'; }
            });
        }

        function addTabEventListeners() {
            const tabs = $$('#tabs button');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => {
                        t.className = 'flex-shrink-0 flex items-center gap-2 px-3 py-3 text-sm font-medium border-b-2 transition-all duration-200 rounded-t-md border-transparent text-slate-400 hover:text-white hover:bg-slate-800/30';
                    });
                    $$('.tab-content').forEach(c => c.classList.add('hidden'));
                    
                    tab.className = 'flex-shrink-0 flex items-center gap-2 px-3 py-3 text-sm font-medium border-b-2 transition-all duration-200 rounded-t-md border-blue-500 text-white bg-slate-800/50';
                    const content = $(`#content-${tab.dataset.tab}`);
                    if (content) {
                        content.classList.remove('hidden');
                        content.classList.add('fade-in');
                    }
                });
            });
        }
        
        function addCopyEventListeners() {
            $('#results-state').addEventListener('click', (e) => {
                const copyButton = e.target.closest('.copy-btn');
                if (copyButton) copyToClipboard(copyButton.dataset.copy, copyButton);
            });
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            renderHistory();
            $('#copyright-year').textContent = new Date().getFullYear();

            $('#analyzeBtn').addEventListener('click', () => analyzeWebsite());
            $('#urlInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') analyzeWebsite(); });
            
            $$('.example-url-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    $('#urlInput').value = `https://${btn.textContent}`;
                    analyzeWebsite();
                });
            });

            $('#history-list').addEventListener('click', (e) => {
                e.preventDefault();
                const link = e.target.closest('.history-item-link');
                const removeBtn = e.target.closest('.remove-history-item');
                
                if (link) {
                    $('#urlInput').value = `https://${link.dataset.url}`;
                    analyzeWebsite(link.dataset.url);
                }
                if (removeBtn) {
                    removeFromHistory(removeBtn.dataset.url);
                }
            });
        });
    </script>
</body>
</html>
